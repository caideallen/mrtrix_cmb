## checking shit works before I run it as a batch
## replace ${ID} with 10002

mrregister wmfod/10002_wmfod.mif -mask1 dwimask/10002_dwimask.mif wmfod_template.mif -nl_warp subj2temp/10002_subject2template_warp.mif temp2subj/10002_template2subject_warp.mif
mrtransform dwimask/10002_dwimask.mif -warp subj2temp/10002_subject2template_warp.mif -interp nearest -datatype bit maskintemp/10002_maskintemp.mif

for ID in $(seq 10003 10150) $(seq 11001 11107); do
mrtransform dwimask/${ID}_dwimask.mif -warp subj2temp/${ID}_subject2template_warp.mif -interp nearest -datatype bit maskintemp/${ID}_maskintemp.mif
done

mkdir fodintemp_not_reoriented
for ID in $(seq 10003 10150) $(seq 11001 11107); do
mrtransform wmfod/${ID}_wmfod.mif -warp subj2temp/${ID}_subject2template_warp.mif -reorient_fod no fodintemp_not_reoriented/${ID}_fodintemp_NOT_REORIENTED.mif
done
mrtransform wmfod/10002_wmfod.mif -warp subj2temp/10002_subject2template_warp.mif -reorient_fod no fodintemp_not_reoriented/10002_fodintemp_NOT_REORIENTED.mif

fod2fixel -mask template_mask.mif fodintemp_not_reoriented/10002_fodintemp_NOT_REORIENTED.mif fixelintemp_not_reoriented/10002_fixel_in_template_space_NOT_REORIENTED -afd 10002_fd.mif
fixelreorient fixelintemp_not_reoriented/10002_fixel_in_template_space_NOT_REORIENTED subj2temp/10002_subject2template_warp.mif fixel_in_temp/10002_fixel_in_template_space
fixelcorrespondence fixel_in_temp/10002_fixel_in_template_space/10002_fd.mif fixel_mask fd/10002 10002.mif
warp2metric subj2temp/10002_subject2template_warp.mif -fc fixel_mask fc/10002 10002.mif
